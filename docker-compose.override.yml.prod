# The following configuration is used for production in conjunction with the
# main docker-compose.yml. Please follow the instructions in the README.md
# file to deploy the application.

services:
  train-app:
    image: unillett/training:latest
    build:
      context: ./
      dockerfile: ./docker/app.dockerfile
      target: prod
      secrets:
        - backpack_username
        - backpack_password
    env_file:
      - ./site/.env
    volumes:
      - uploads-data:/var/www/training/storage/app/public/uploads
      - logs-data:/var/www/training/storage/logs
    restart: unless-stopped
    deploy:
      mode: global
      resources:
        limits:
          memory: 1000M
  train-mysql:
    restart: unless-stopped
    deploy:
      mode: global
      resources:
        limits:
          memory: 500M

secrets:
  backpack_username:
    file: ./docker/secrets/backpack_username.txt
  backpack_password:
    file: ./docker/secrets/backpack_password.txt

volumes:
  uploads-data:
  logs-data:
